---
title: "Why stemmed points? Understanding the usage of the Korea Late Paleolithic stemmed points using tip cross-sectional area"
author:
  - Gayoung Park: 
      email: gayoungp@uw.edu
      institute: [Uof W]
      correspondence: true
  - Marlize Lombard:
      email: mlombard@uj.ac.za
      institute: [UofJ]
      correspondence: false
  - Ben Marwick:
      email: bmarwick@uw.edu
      institute: [UofW]
      correspondence: false
institute:
  - UofW: University of Washington
  - UofJ: Palaeo-Research Institute, University of Johannesburg

date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    bookdown::word_document2:
      fig_caption: yes
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
      pandoc_args:
      - --lua-filter=../templates/scholarly-metadata.lua
      - --lua-filter=../templates/author-info-blocks.lua
      - --lua-filter=../templates/pagebreak.lua
bibliography: references.bib
csl: "../templates/journal-of-archaeological-science.csl" # Insert path for the bib-style
abstract: |
  Text of abstract
keywords: |
  keyword 1; keyword 2; keyword 3
highlights: |
  These are the highlights. 
---

<!-- This is the format for text comments that will be ignored during renderings. Do not put R code in these comments because it will not be ignored. -->

<!-- With the following code you can access and display values from the yml header above. -->

Keywords: `r rmarkdown::metadata$keywords`

Highlights: `r rmarkdown::metadata$highlights`

<!-- The following code chunk defines some general settings how code chunks should behave. -->

```{r setup, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  fig.path = "../figures/",
  dpi = 300
)
```

<!-- The actual document text starts here: -->

# Introduction

# Background

# Methods

# Results

```{r}
library(readxl)
library(here)
library(tidyverse)
library(ggbeeswarm)

mydata <- read_excel(here("analysis/data/raw_data/TCSA_raw_data.xlsx"))

tcsa <- mydata %>%
  mutate(min_tcsa = 0.5 *Width * Thickness) %>%
  mutate(max_tcsa = 0.5 *Length * Thickness) %>%
  #omit very large TCSA, could be measurement error
  filter(min_tcsa <= 250) %>%
  # group rare raw materials
  mutate(raw_materials_top = fct_lump_min(Raw_material, 10)) %>%
  mutate(site_name_top = fct_lump_min(Site_name, 5))

```


```{r, fig.width= 4.5, fig.height=6}
# all artefacts overall
ggplot (tcsa,
        aes(1, min_tcsa)) +
  # show regions for tools from Table 3 of Lomabrd 2021
  # https://www-sciencedirect-com.offcampus.lib.washington.edu/science/article/pii/S0277379121002286
    annotate("rect", 
           xmin = -Inf,
           xmax = Inf,
           ymin = 4,
           ymax = 18,
           fill = "green",
           alpha = 0.2) +
      annotate("text", 
               size = 3,
               label = "Poisoned arrowheads",
           x = 1.27,
           y = (18-4) /2 + 4) +
      annotate("rect", 
           xmin = -Inf,
           xmax = Inf,
           ymin = 13,
           ymax = 53,
           fill = "blue",
           alpha = 0.2) +
      annotate("text", 
               size = 3,
               label = "Arrowheads",
           x = 1.3,
           y = (53-13) /2 + 13) +
      annotate("rect", 
           xmin = -Inf,
           xmax = Inf,
           ymin = 40,
           ymax = 76,
           fill = "orange",
           alpha = 0.2) +
      annotate("text", 
               size = 3,
               label = "Dart tips",
           x = 1.3,
           y = (76-40) /2 + 40 ) +
      annotate("rect", 
           xmin = -Inf,
           xmax = Inf,
           ymin = 44,
           ymax = 98,
           fill = "purple",
           alpha = 0.2) +
      annotate("text", 
               size = 3,
               label = "Javelin",
           x = 1.3,
           y = (98-44) /2 + 44 ) +
     annotate("rect", 
           xmin = -Inf,
           xmax = Inf,
           ymin = 88,
           ymax = 230,
           fill = "yellow",
           alpha = 0.2) +
      annotate("text", 
               label = "Thrusting spear",
               size = 3,
           x = 1.3,
           y = (230-88) /2 + 88 ) +
  geom_boxplot(alpha = 0.1) +
  geom_quasirandom(alpha = 0.4,
                   size = 2.3) +
  theme_bw() +
  labs(y = "TCSA")
```
1) The mean TCSA of the Korean stemmed point is `r paste0(round(mean(tcsa$min_tcsa), digits=1))`, and SD TCSA is `r paste0(round(sd(tcsa$min_tcsa), digits=1))`.  
2) According to the Lombard's TCSA range, Korean stemmed points are included mostly in the categories of javelins and thrusting spear tips but overall the boxplot represents wide TCSA variation.  
3) The individual weapon categories of TCSA range are overlapped a lot. We chose the specific colors for the annotation boxes to match with Figure 5 of Lombard's 2021 QSR paper.


```{r}

### create column for "n = xx "
tcsa_raw <- tcsa %>% 
  group_by(raw_materials_top) %>% 
  add_tally() %>% 
  filter(n>1) %>% 
  mutate(label_raw = as.factor(paste0(raw_materials_top,' (N = ', n, ")"))) %>%   
  select(-n) %>%
  nest(-raw_materials_top, -label_raw) 

tcsa_site <- tcsa %>% 
  group_by(site_name_top) %>% 
  add_tally() %>% 
  filter(n>1) %>% 
  mutate(label_site = as.factor(paste0(site_name_top,' (N = ', n, ")"))) %>%   
  select(-n) %>%
  nest(-site_name_top, -label_site) %>% 
  select(-data)

tcsa_label <- tcsa %>% 
  left_join(tcsa_raw) %>% 
  left_join(tcsa_site)
```

```{r}
#### histogram for min tcsa to prepare for exploring the data
all <- ggplot(tcsa_label,
              aes(min_tcsa)) +
  geom_histogram(color="black", fill="grey90") +
  theme_bw() +
  labs(x = "TCSA", 
       y = "Count")
```

## Raw materials

```{r, fig.height=5}
# Facet by raw materials
all +  facet_wrap(~label_raw,
                  scales = "free_y",
                  ncol = 1) 
 
                  
```

1) About half of the stemmed points made out of shale. 
2) Acidic volcanic rocks tend to have more screwed and lower TCSA value. 
3) But overall, there is no clear pattern.



## Variation by site

```{r, fig.height=5}
# Facet by site
all +  facet_wrap(~label_site,
                 scales = "free_y",
                  ncol = 1)
```

1) We computed TCSA for sites that include >= 5 stemmed points.
2) Suyanggage has the most stemmed points and the range of TCSA is wide. We can assume that people used stemmed points with different purposes. 
3) Nosanri and Sibuk have skewed and smaller TCSA values.
4) The bigger ones are mainly in the category of Other.

## Variation by artefact size
We wanted to check the relationship between TCSA and size. Weight can represent overall tool size. 

```{r, fig.width= 4.5, fig.height=4.6}
# how does the size-tcsa relationship vary by raw material?

# remove NAs
tcsa_mass_no_na <-
  tcsa_label %>%
 drop_na(`Weight(g)`)


ggplot(tcsa_mass_no_na,
       aes(`Weight(g)`,
           min_tcsa,
           colour = label_raw)) +
  geom_point() +
    labs(x = "Weight", 
       y = "TCSA",
       colour='Raw material type') +
  geom_smooth(method=lm, se=FALSE, size = 0.4)+
  theme_bw() +
  theme(
  legend.title = element_text(size = 8),
  legend.text = element_text(size = 7)
  )
```

1) TCSA and Weight have positive relationship. 
2) Shale stemmed points tend to be heavier than the other raw materials, while acidic volcanic rocks are lighter.

```{r, fig.width= 4}
# Facet by size class

# https://cran.r-project.org/web/packages/Ckmeans.1d.dp/vignettes/Ckmeans.1d.dp.html
library(Ckmeans.1d.dp)

# find clusters
result <- Ckmeans.1d.dp(tcsa_mass_no_na$`Weight(g)`)

tcsa_mass_no_na <-
tcsa_mass_no_na %>%
  mutate(mass_cluster = factor(result$cluster))

ggplot (tcsa_mass_no_na,
        aes(1, `Weight(g)`)) +
  geom_boxplot() +
  geom_quasirandom(aes(colour = mass_cluster),
                   alpha = 0.4,
                   size = 2.5) +
  labs(colour='Cluster') +
  theme_bw()
```

1) Determined by Bayesian information criterion, our weight data is divided into three cluster.
2) Most artifacts are under 20. 

```{r, fig.height=4}
ggplot(tcsa_mass_no_na,
       aes(min_tcsa)) +
  geom_histogram(color="black", fill="grey90") +
  theme_bw() +
  facet_wrap(~mass_cluster,
             ncol = 1,
             scales = "free_y")+
 labs(x = "TCSA", 
       y = "Count")
```
1) TCSA of the three cluster shows clear pattern.  
2) Cluster 1, the smallest (lightest) artifacts, is the lower TCSA, compared Cluster 2. TCSA of Cluster 3 is the highest, except for one artifact, which is lower than 50.  
3) We can assumed that artifacts in different clusters might be made for different purposes.

# Discussion

# Conclusion

# Acknowledgements

<!-- The following line inserts a page break  -->

\newpage

# References 

<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->

<div id="refs"></div>

\newpage

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies: 

```{r colophon, cache = FALSE}
# which R packages and versions?
if ("devtools" %in% installed.packages()) devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? 
if ("git2r" %in% installed.packages() & git2r::in_repository(path = ".")) git2r::repository(here::here())  
```
